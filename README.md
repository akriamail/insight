# 🚀 Project Team - Insight Infrastructure

## 项目概述
Project Team Insight Infrastructure 是一个基于 Docker Compose 部署的集成基础设施管理系统。它采用扁平化架构设计，旨在实现“配置与数据分离”，提供一键部署、交互式管理与全量备份功能，为团队提供一套高效、稳定的运营支撑环境。

## 功能特性
*   **统一网关管理:** 基于 Nginx Proxy Manager，实现 HTTP/HTTPS 流量的统一代理、负载均衡和自动化 SSL 证书管理。
*   **核心数据库服务:** 使用 PostgreSQL 作为所有应用的基础数据存储，确保数据可靠性和一致性。
*   **灵活的工作流自动化:** 集成 n8n，支持可视化地构建和自动化复杂的业务流程与集成任务。
*   **数据可视化与低代码:** 利用 NocoDB 提供强大的数据表格界面和低代码开发能力，简化数据管理和应用构建。
*   **团队知识管理:** 搭建 Wiki.js 知识库平台，促进团队知识沉淀、共享与协作。
*   **分层系统管理:**
    *   **基础运维:** 日常启动、停止、备份及实时健康监控。
    *   **高级维护:** 环境初始化、一键生产部署、镜像配置及高风险的系统恢复与重置。
*   **实时监控:** 提供 CPU、内存、磁盘占用及 Docker 容器资源的实时监控报告。
*   **全量备份与恢复:** 实现 Nginx Proxy Manager 配置和所有 PostgreSQL 数据库的全量备份，并支持一键恢复到最新状态。
*   **配置与数据分离:** 通过清晰的目录结构和 Docker 卷挂载，确保业务数据与应用配置独立管理，方便升级和迁移。

## 技术栈
*   **容器化:** Docker, Docker Compose
*   **网关:** Nginx Proxy Manager
*   **数据库:** PostgreSQL
*   **工作流:** n8n
*   **数据管理:** NocoDB
*   **知识库:** Wiki.js
*   **脚本语言:** Bash

## 目录结构
```
.
├── manage.sh              # 🚀 唯一交互式入口 (分层菜单)
├── README.md              # 本项目操作说明
├── .gitignore             # Git 忽略配置
├── .env.example           # 环境变量配置示例文件
├── data/                  # [生产数据] 实际业务数据挂载点
├── infra/                 # [核心配置] 基础设施相关配置与脚本
│   ├── compose/           # Docker Compose 蓝图文件 (.yml)
│   └── scripts/           # 自动化运维脚本
├── exports/               # [备份产出] 存放生成的全量备份压缩包
└── backups/               # [临时备份区] 存放细粒度备份文件
```

## 快速入门

### 1. 全新服务器部署
对于一台全新的服务器，推荐进入高级菜单执行一键部署。

```bash
git clone https://github.com/akriamail/insight.git /opt/insight
cd /opt/insight
./manage.sh
# 选择 5 (高级维护) -> 选择 1 (一键生产环境部署)
```

### 2. 交互式管理入口
只需运行根目录下的 `manage.sh` 脚本，即可进入分层菜单：

```bash
./manage.sh
```

**菜单功能一览：**

**[一级菜单：基础运维]**
*   **1) 🚀 启动服务 (Up):** 拉起所有容器并自动初始化数据库。
*   **2) 🛑 停止服务 (Down):** (需确认) 安全移除所有容器。
*   **3) 📊 状态与监控 (Status):** 合并查看容器运行详情及服务器硬件健康状态。
*   **4) 📂 数据备份 (Backup):** 生成全量数据包至 `exports/`。
*   **5) ⚙️ 高级维护与部署 (Advanced)...:** 进入二级菜单。

**[二级菜单：高级维护]**
*   **1) ✨ 一键生产环境部署 (Full Setup):** 自动化完成环境初始化、服务启动及数据库配置。
*   **2) 🛠️ 初始化基础环境 (Init Env):** 仅安装 Docker 等基础依赖并进行内核优化。
*   **3) 🌐 Docker 镜像源配置 (Mirror Config):** 切换或配置 Docker 镜像加速器。
*   **4) ⚠️ 全量数据恢复 (Restore):** (需确认) 从备份包一键还原所有数据。
*   **5) 🗑️ 重置系统 (危险):** (需确认) 停止所有容器、移除网络并 **彻底删除** 持久化数据。

## 环境变量配置
本项目通过 `.env` 文件管理各项参数。请参考 `.env.example` 创建您的 `.env` 文件。

**配置生效：** 更改 `.env` 文件后，通常需要重启服务。建议在高级菜单中执行“重置系统”后再重新“一键部署”以确保配置完全应用。

## 维护规范
*   **安全确认:** 危险操作均设有 `(y/n)` 二次确认。
*   **Git 同步:** 仅提交 `infra/` 变更，禁止将 `data/` 存入仓库。
*   **凭证管理:** 严禁硬编码密码，统一使用 `.env` 环境变量。
*   **定期备份:** 建议每日执行 `Backup`。
